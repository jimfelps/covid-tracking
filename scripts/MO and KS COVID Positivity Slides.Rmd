---
title: "COVID-19 Positive Rates in Missouri, Kansas, and Selected States"
author: "Jim Felps"
date: "6/14/2020"
output:
  powerpoint_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```


```{r}
source('./scripts/Libraries and Variables.R')
source('./scripts/Daily State Data.R')
source('./scripts/KC Metro Counties - Covdata.R')
source('./scripts/MO Counties - Covdata.R')
source('./scripts/Apple Mobility Data.R')
source('./scripts/Google Mobility Data.R')

```

## Missouri

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "MO",
         date > "2020-03-27") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity", col = "#811609", size = 1) +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = '<b style="color:#811609">This Week\'s Data</b>',
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )   +
  gghighlight(
    date >= floor_date(Sys.Date(), "weeks"),
    unhighlighted_colour = alpha("steelblue", 0.4)
  ) +
  theme(
    plot.subtitle = element_markdown()
  )

ggsave("images/missouri.png")
```
```{r fig.height=8, fig.width=12}

# messing around with ventilator and hospitalizations...might adjust

state_data %>%
  filter(state == "MO",
         date > "2020-03-01") %>%
  ggplot() +
    geom_bar(aes(x = date, y = new_pos), fill = "#0c7650", stat = "identity") +
    geom_line(aes(x = date, y = onVentilatorCurrently), size = 1, color = "#e8174a") +
    geom_line(aes(x = date, y = hospitalizedCurrently), color = "#1b61da") +
    labs(
      x = "",
      y = "",
      title = 'Patients in the State of Missouri Currently <b style="color:#1b61da">Hospitalized</b> or on <b style="color:#e8174a">Ventilators</b> for COVID',
      subtitle = '<b style="color:#0c7650">Daily New Positive Cases</b>',
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )   +
  theme_minimal() +
  theme(
    plot.title = element_markdown(),
    plot.subtitle = element_markdown()
  ) +
  guides(color = FALSE) -> p

ggplotly(p)

ggsave("images/mo_hos_vent.png", p)
```

```{r fig.height=8, fig.width=12}

# messing around with ventilator and hospitalizations...might adjust

state_data %>%
  filter(state == "CA",
         date > "2020-03-01") %>%
  ggplot() +
    geom_bar(aes(x = date, y = new_pos), fill = "#0c7650", stat = "identity") +
    geom_line(aes(x = date, y = inIcuCurrently), size = 1, color = "#e8174a") +
    geom_line(aes(x = date, y = hospitalizedCurrently), size = 1, color = "#1b61da") +
    labs(
      x = "",
      y = "",
      title = 'Patients in the State of California Currently <b style="color:#1b61da">Hospitalized</b> or in <b style="color:#e8174a">ICU</b> for COVID',
      subtitle = '<b style="color:#0c7650">Daily New Positive Cases</b>',
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )   +
  theme_minimal() +
  theme(
    plot.title = element_markdown(),
    plot.subtitle = element_markdown()
  ) +
  guides(color = FALSE) 

ggsave("images/ca_hos_icu.png")

```


```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "MO",
         date >= "2020-06-01") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity", , col = "darkred", size = 1) +
    labs(
      x = "",
      y = "",
      title = "Missouri Positivity Rate since June 1, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/"
        )  +
  gghighlight(
    date >= floor_date(Sys.Date(), "weeks"),
    unhighlighted_colour = alpha("steelblue", 0.4)
  )

ggsave("images/missouri_june.png")
```


## Kansas

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "KS",
         date > "2020-03-19") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity", col = "darkred", size = 1)  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "Red portion = this week's data",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        ) +
  gghighlight(
    date >= floor_date(Sys.Date(), "weeks"),
    unhighlighted_colour = alpha("steelblue", 0.4)
  )

ggsave("images/ks.png")
```

# Metro Area New Positive Cases

```{r fig.height=8, fig.width=12}
metro_kc_grouped %>% 
  ggplot(aes(date, new_pos_7dma)) +
  geom_line(size = 1, color = "firebrick") +
  labs(
    x = "",
    y = "",
    title = "KC Metro Area Daily Positive Tests, 7 day moving average",
    caption = "Data from NYT Covid repository \nhttps://github.com/nytimes/covid-19-data\nVisual: Jim Felps"
  ) +
  guides(color = FALSE) +
  scale_x_date(expand = c(0,15))

ggsave("images/metro_grouped.png")

```

# Ballpark Odds of Meeting Someone Infected in the Metro
# Metro Area New Positive Cases

```{r fig.height=8, fig.width=12}
metro_kc_grouped %>% 
  ggplot(aes(date, infect_prob)) +
  geom_line(size = 1, color = "firebrick") +
  labs(
    x = "",
    y = "",
    title = "Percent of Metro Area Population Potentially Contagious Each Day",
    caption = "Data from NYT Covid repository \nhttps://github.com/nytimes/covid-19-data\nVisual: Jim Felps"
  ) +
  guides(color = FALSE) +
  scale_x_date(expand = c(0,15)) +
  scale_y_continuous(labels = scales::percent)

ggsave("images/metro_prob.png")

```

# County-level analysis - KC Metro

## New Positive Cases by County
```{r fig.height=8, fig.width=12}
metro_kc %>% 
  ggplot(aes(date, new_pos_7dma, group = county, color = county)) +
  geom_line(size = 1) +
  geom_dl(aes(label = county), method = 'last.bumpup') +
  scale_color_viridis(discrete = TRUE) +
  labs(
    x = "",
    y = "",
    title = "Daily Positive Tests, 7 day moving average",
    caption = "Data from NYT Covid repository \nhttps://github.com/nytimes/covid-19-data\nVisual: Jim Felps"
  ) +
  guides(color = FALSE) +
  scale_x_date(expand = c(0,15))

ggsave("images/metro_counties.png")

```

## All MO Counties

```{r fig.height=8, fig.width=12}
mo_counties_7ma %>% 
  ggplot(aes(date, new_pos_7dma, group = county)) +
  geom_line(size = 1, col = "darkred") +
  labs(
    x = "",
    y = "",
    title = "Missouri Daily Positive Tests",
    subtitle = "7 day moving average",
    caption = "Data from NYT Covid repository \nhttps://github.com/nytimes/covid-19-data\nVisual: Jim Felps"
      ) +
  gghighlight(county %in% select_counties,
              unhighlighted_colour = alpha("steelblue", 0.4),
              use_direct_label = FALSE) +
  geom_dl(aes(label = county), method = 'last.bumpup') +
  scale_x_date(expand = c(0,15))


#label_key = county,
#              label_params = list(size = 3)
ggsave("images/mo_counties.png")
```

## Apple Mobility Data - Metro Counties

```{r fig.height=8, fig.width=12}
vec_brks <- c(-50, 0, 50)
vec_labs <- vec_brks + 100

metro_driving %>% 
  ggplot(aes(date, index, group = region, color = over_under)) +
  geom_hline(yintercept = 0, color = "gray") +
  geom_col() +
  scale_y_continuous(breaks = vec_brks, labels = vec_labs) +
  scale_color_manual(values = c("firebrick", "steelblue")) +
  facet_wrap(~ region, nrow = 3, ncol = 3) +
  labs(x = "Date", 
       y = "Relative Mobility",
       title = "Relative Trends in Apple Maps Usage for Driving, KC Metro Area",
       caption = "Source: Apple\nVisual: Jim Felps") +
  guides(color = FALSE) +
  theme_minimal()

ggsave("images/metro_driving_apple.png")
```

# Google Mobility Data
```{r fig.height=8, fig.width=12}
metro_summary %>% 
  ggplot(aes(date, pct_change, group = type, color = type)) +
  geom_line(size = 0.5, color = "gray80") +
  geom_smooth(aes(color = type, group = type), se = FALSE) +
  theme_minimal() +
  facet_wrap(~ type, ncol = 3) +
  labs(x = "Date",
       y = "% Change from Baseline",
       title = "Relative Trends in Mobility for Kinds of Location in the KC Metro",
       subtitle = "Data relative to median activity from 1/3 to 2/6",
       caption = paste0("Source: Google LLC 'Google COVID-19 Community Mobility Reports'\nhttps://www.google.com/covid19/mobility/ Accessed: ", Sys.Date(),"\nVisual: Jim Felps")) +
  theme(legend.position = "none")

ggsave("images/metro_google.png")
```


# Select States with Problematic Trends \n(based on media coverage)

## Arizona

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "AZ",
         date > "2020-03-26") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "New COVID Positive Tests and Hospitalizations in Arizona",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/az.png")
```

## AZ Hospital and Vent Graph
```{r}
state_data %>%
  filter(state == "AZ",
         date > "2020-03-01") %>%
  ggplot() +
    geom_bar(aes(x = date, y = new_pos), fill = "#0c7650", stat = "identity") +
    geom_line(aes(x = date, y = onVentilatorCurrently), size = 1, color = "#e8174a") +
    geom_line(aes(x = date, y = hospitalizedCurrently), size = 1, color = "#1b61da") +
    labs(
      x = "",
      y = "",
      title = 'Patients in Arizona Currently <b style="color:#1b61da">Hospitalized</b> or on <b style="color:#e8174a">Ventilators</b> for COVID',
      subtitle = '<b style="color:#0c7650">Daily New Positive Cases</b>',
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )   +
  theme_minimal() +
  theme(
    plot.title = element_markdown(),
    plot.subtitle = element_markdown()
  ) +
  guides(color = FALSE)

ggsave("images/az_hos_vent.png")
```


## OK

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "OK",
         date > "2020-04-10") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/ok.png")
```

## Alabama

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "AL",
         date > "2020-03-21") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/al.png")
```

## Florida

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "FL",
         date > "2020-03-21") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/fl.png")
```

## Arkansas

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "AR",
         date > "2020-04-01") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/ar.png")
```

## California

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "CA",
         date > "2020-04-15") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/ca.png")
```

## Deleware

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "DE",
         date > "2020-04-01") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/de.png")
```

## Georgia

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "GA",
         date > "2020-03-01") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/ga.png")
```

## Oregan

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "OR",
         date > "2020-03-20") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/or.png")
```

## North Carolina

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "NC",
         date > "2020-03-15") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/nc.png")
```

## Nevada

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "NV",
         date > "2020-03-20") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/nv.png")
```

## Texas

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "TX",
         date > "2020-03-20") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/tx.png")
```

## Tennessee

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "TN",
         date > "2020-03-20") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/tn.png")
```

## Vermont

```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "VT",
         date > "2020-04-15") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/ca.png")
```

## New York


```{r fig.height=8, fig.width=12}
state_data %>%
  filter(state == "NY",
         date > "2020-03-12") %>%
  ggplot(aes(date, pos_rate_7dma)) +
    geom_line(stat = "identity")  +
    labs(
      x = "",
      y = "",
      title = "COVID Testing Positivity, 7 Day Moving Average",
      subtitle = "",
      caption = "Data from COVID Tracking project\nhttps://covidtracking.com/\nVisual: Jim Felps"
        )

ggsave("images/ny.png")
```

